{% extends "app/base.html" %}
{% block title %}
    {{ game.name }}
{% endblock title %}
{% block content %}
    <div id="top">
        {% if outcome %}<strong>{{ game.name }}</strong>'s outcome was {{ outcome }}{% endif %}
        {% if not outcome %}
            {% if whose_turn == "white" %}
                <form id="move"
                      method="post"
                      name="move"
                      action="{% url 'move' game_id=game.pk %}">
                    {% csrf_token %}
                </form>
            {% endif %}
        {% endif %}
        <div id="board-plus-eventlog">
            <div class="board">
                {% for s in squares %}{{ s }}{% endfor %}
            </div>
            <div id="event-log-and-captured-pieces">
                <div id="event-log">
                    <h3>
                        <a href="https://en.wikipedia.org/wiki/Algebraic_notation_(chess)">Moves</a>
                    </h3>
                    {% for line in event_log %}<div>{{ line }}</div>{% endfor %}
                </div>
                <div id="captured-pieces">
                    <div id="black-captured-pieces">
                        {% for piece in captured_pieces.0 %}<div>{{ piece }}</div>{% endfor %}
                    </div>
                    <div id="white-captured-pieces">
                        {% for piece in captured_pieces.1 %}<div>{{ piece }}</div>{% endfor %}
                    </div>
                <div>
                    <a href="{% url 'pgn-game' game_id=game.pk %}">PGN</a>
                </div>
                </div>
            </div>
        </div>
        <div id="status-whatnots">
            {% include "app/new-game-form.html" %}
            {% if not outcome %}
            {% include "app/smartness-slider.html" %}
                <div id="whose-turn">It's {{ whose_turn }}'s turn</div>
            {% endif %}
        </div>
    </div>
{% endblock content %}
{% block scripts %}
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.6/dist/htmx.min.js"></script>
    <script>
     function scrollEventLogToEnd() {
         var eventLog = document.querySelector("#event-log")
         eventLog.scrollTop = eventLog.scrollHeight;
     }
     if (document.readyState === "loading") {
         // Loading hasn't finished yet
         document.addEventListener("DOMContentLoaded", scrollEventLogToEnd);
     } else {
         // `DOMContentLoaded` has already fired
         scrollEventLogToEnd();
     }
    </script>
{% endblock scripts %}
